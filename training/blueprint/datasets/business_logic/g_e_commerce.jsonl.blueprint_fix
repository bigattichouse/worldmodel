{"id": "blueprint_biz_081", "category": "e_commerce", "difficulty": "intermediate", "user_query": "Shopping cart management system", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- A system to manage a user's shopping cart, allowing items to be added, removed, and quantities updated.\n- The cart should persist across sessions and handle anonymous users.\n\nSTRATEGIC APPROACH:\n- Design a `ShoppingCartService`.\n- Define a `Cart` entity that holds `CartItem`s.\n- Implement methods for CRUD operations on cart items and for retrieving the cart.\n- The cart should be associated with a user ID (for logged-in users) or a session ID (for anonymous users).\n\nDESIGN PREPARATION:\n- `Cart` data model (id, userId/sessionId, items: array[CartItem], createdAt, updatedAt).\n- `CartItem` data model (productId, quantity, priceAtTimeOfAdding).\n- `ShoppingCartService` with methods: `getCart`, `addItem`, `updateItemQuantity`, `removeItem`, `clearCart`.\n- `ShoppingCartRepository` for persistence.\n- Error handling for `CartNotFound`, `ProductNotFound`, `InvalidQuantity`.\n</thinking>\n\n<blueprint>\nService ShoppingCartService {\n  description: \"Manages a user's shopping cart, allowing item additions, removals, and quantity updates.\",\n  dependencies: {\n    cartRepo: ShoppingCartRepository,\n    productService: ProductCatalogService // To validate product existence and fetch price\n  },\n  methods: {\n    getCart(userId: UUID | null, sessionId: UUID | null) -> Cart {\n      preconditions: [userId or sessionId must be provided],\n      postconditions: [returns the user's current shopping cart, creating a new one if none exists],\n      errors: []\n    },\n    addItem(cartId: UUID, productId: UUID, quantity: int) -> Cart {\n      preconditions: [cartId exists, productId exists, quantity > 0],\n      postconditions: [item is added to the cart; if already present, quantity is updated],\n      errors: [CartNotFound, ProductNotFound, InvalidQuantity]\n    },\n    updateItemQuantity(cartId: UUID, productId: UUID, newQuantity: int) -> Cart {\n      preconditions: [cartId exists, productId exists in cart, newQuantity >= 0],\n      postconditions: [quantity of item in cart is updated; if newQuantity is 0, item is removed],\n      errors: [CartNotFound, ProductNotFoundInCart, InvalidQuantity]\n    },\n    removeItem(cartId: UUID, productId: UUID) -> Cart {\n      preconditions: [cartId exists, productId exists in cart],\n      postconditions: [item is removed from the cart],\n      errors: [CartNotFound, ProductNotFoundInCart]\n    },\n    clearCart(cartId: UUID) -> Cart {\n      preconditions: [cartId exists],\n      postconditions: [all items are removed from the cart],\n      errors: [CartNotFound]\n    }\n  }\n}\n\nService ShoppingCartRepository {\n  methods: {\n    save(cart: Cart) -> Cart;\n    findById(cartId: UUID) -> Cart;\n    findByUserId(userId: UUID) -> Cart;\n    findBySessionId(sessionId: UUID) -> Cart;\n  }\n}\n\nService ProductCatalogService {\n  methods: {\n    getProductDetails(productId: UUID) -> Product; // Returns Product with price\n  }\n}\n\nType Cart {\n  id: UUID,\n  userId: UUID | null,\n  sessionId: UUID | null,\n  items: array[CartItem],\n  totalAmount: float,\n  createdAt: timestamp,\n  updatedAt: timestamp\n}\n\nType CartItem {\n  productId: UUID,\n  quantity: int,\n  price: float // Price at the time item was added\n}\n</blueprint>"}