{"id": "q_hc_221", "category": "healthcare", "difficulty": "advanced", "user_query": "Patient record management system", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- Need to manage patient records with medical history and demographics\n- Should handle HIPAA compliance and access controls\n- Must support various medical data types and formats\n- Should provide clinical decision support and reporting\n\nSTRATEGIC APPROACH:\n- Create a PatientRecordManagement service with EMR capabilities\n- Implement strict access controls and audit trails\n- Support various medical data formats and coding systems\n- Include clinical decision support tools\n- Ensure compliance with healthcare regulations\n\nDESIGN PREPARATION:\n- Core operations: createPatient, updateRecord, accessRecord\n- Patient demographics and medical history management\n- Access control with role-based permissions\n- Audit trails for compliance\n</thinking>\n\n<blueprint>\nService PatientRecordManagement {\n  description: \"Manages patient records with medical history and demographics, ensuring HIPAA compliance\",\n  \n  dependencies: {\n    storage: PatientDatabase,\n    auth: AccessControlService,\n    audit: AuditService,\n    compliance: ComplianceChecker,\n    notifications: NotificationService,\n    clinical: ClinicalDecisionSupport\n  },\n  \n  methods: {\n    createPatient(patientDetails: PatientRegistration) -> PatientRecord {\n      preconditions: [valid patient details, user authorized],\n      postconditions: [patient record created, demographics stored],\n      errors: [InvalidPatientDetails, UnauthorizedAccess]\n    },\n    \n    updatePatientRecord(patientId: PatientId, recordUpdate: MedicalRecordUpdate) -> MedicalRecordUpdateResult {\n      preconditions: [patient exists, user authorized for specialty],\n      postconditions: [medical record updated, audit logged],\n      errors: [PatientNotFound, UnauthorizedAccess, InvalidMedicalData]\n    },\n    \n    accessPatientRecord(patientId: PatientId, requestingProviderId: ProviderId, purpose: AccessPurpose) -> PatientRecord {\n      preconditions: [patient exists, provider authorized, valid purpose],\n      postconditions: [patient record returned, access logged],\n      errors: [PatientNotFound, UnauthorizedAccess]\n    },\n    \n    addClinicalNote(patientId: PatientId, note: ClinicalNote) -> ClinicalNoteResult {\n      preconditions: [patient exists, provider authorized],\n      postconditions: [clinical note added, audit logged]\n    },\n    \n    getPatientHistory(patientId: PatientId, filters: MedicalHistoryFilters?) -> MedicalHistory {\n      preconditions: [patient exists, user authorized],\n      postconditions: [returns filtered medical history]\n    },\n    \n    generateClinicalReport(patientId: PatientId, reportType: ClinicalReportType, providerId: ProviderId) -> ClinicalReport {\n      preconditions: [patient exists, provider authorized],\n      postconditions: [returns requested clinical report]\n    },\n    \n    scheduleAppointment(patientId: PatientId, appointmentDetails: AppointmentRequest) -> AppointmentResult {\n      preconditions: [patient exists, provider available],\n      postconditions: [appointment scheduled, patient notified]\n    }\n  }\n}\n\nDatabase PatientDatabase {\n  Table Patients {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      mrn: {type: String, unique: true, required: true, maxLength: 50},  // Medical Record Number\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      date_of_birth: {type: Date, required: true},\n      gender: {type: String, enum: [\"male\", \"female\", \"other\", \"unknown\"]},\n      address: {type: JSON},  // {street, city, state, zip, country}\n      phone: {type: String, maxLength: 20},\n      email: {type: String, maxLength: 100},\n      emergency_contact: {type: JSON},  // {name, relationship, phone}\n      insurance_info: {type: JSON},  // {provider, policy_number, group_number}\n      primary_care_physician_id: {type: UUID, foreignKey: \"Providers.id\"},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_mrn\", columns: [\"mrn\"]},\n      {name: \"idx_dob\", columns: [\"date_of_birth\"]},\n      {name: \"idx_last_name\", columns: [\"last_name\"]}\n    ]\n  },\n  \n  Table MedicalRecords {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      record_type: {type: String, enum: [\"diagnosis\", \"procedure\", \"medication\", \"lab_result\", \"vital_signs\", \"clinical_note\"], required: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      date_recorded: {type: Date, required: true},\n      data: {type: JSON},  // Record-specific data\n      icd_code: {type: String, maxLength: 10},  // ICD-10 diagnosis code\n      snomed_ct_code: {type: String, maxLength: 18},  // SNOMED CT code\n      status: {type: String, enum: [\"active\", \"resolved\", \"archived\"], default: \"active\"},\n      confidentiality: {type: String, enum: [\"normal\", \"restricted\", \"very restricted\"], default: \"normal\"},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_record\", columns: [\"patient_id\"]},\n      {name: \"idx_provider_record\", columns: [\"provider_id\"]},\n      {name: \"idx_record_type\", columns: [\"record_type\"]},\n      {name: \"idx_icd_code\", columns: [\"icd_code\"]}\n    ]\n  },\n  \n  Table Providers {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      npi: {type: String, unique: true, required: true, maxLength: 10},  // National Provider Identifier\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      specialty: {type: String, maxLength: 100},\n      license_number: {type: String, maxLength: 50},\n      license_state: {type: String, maxLength: 2},\n      facility_id: {type: UUID, foreignKey: \"Facilities.id\"},\n      active: {type: Bool, default: true},\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_npi\", columns: [\"npi\"]},\n      {name: \"idx_specialty\", columns: [\"specialty\"]}\n    ]\n  },\n  \n  Table Facilities {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      name: {type: String, required: true, maxLength: 100},\n      type: {type: String, enum: [\"hospital\", \"clinic\", \"urgent_care\", \"nursing_home\", \"other\"], required: true},\n      address: {type: JSON},  // {street, city, state, zip, country}\n      phone: {type: String, maxLength: 20},\n      cms_certification_number: {type: String, maxLength: 20},\n      active: {type: Bool, default: true}\n    }\n  },\n  \n  Table AccessLogs {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      user_id: {type: UUID, foreignKey: \"Users.id\", required: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\"},\n      action: {type: String, enum: [\"view\", \"create\", \"update\", \"delete\"], required: true},\n      resource_type: {type: String, maxLength: 50},\n      resource_id: {type: UUID},\n      purpose: {type: String, maxLength: 100},\n      ip_address: {type: String, maxLength: 45},\n      user_agent: {type: String, maxLength: 500},\n      timestamp: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_access\", columns: [\"patient_id\", \"timestamp\"]},\n      {name: \"idx_user_access\", columns: [\"user_id\", \"timestamp\"]}\n    ]\n  },\n  \n  Table ClinicalNotes {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      appointment_id: {type: UUID, foreignKey: \"Appointments.id\"},\n      note_type: {type: String, enum: [\"progress\", \"consultation\", \"discharge\", \"admission\", \"operative\"], required: true},\n      content: {type: Text, required: true},\n      status: {type: String, enum: [\"draft\", \"signed\", \"correction\"], default: \"draft\"},\n      signed_at: {type: Timestamp},\n      signed_by: {type: UUID, foreignKey: \"Providers.id\"},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_note\", columns: [\"patient_id\"]},\n      {name: \"idx_provider_note\", columns: [\"provider_id\"]}\n    ]\n  },\n  \n  Table Appointments {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      facility_id: {type: UUID, foreignKey: \"Facilities.id\"},\n      appointment_type: {type: String, maxLength: 50},\n      scheduled_datetime: {type: Timestamp, required: true},\n      duration_minutes: {type: Int, default: 30},\n      status: {type: String, enum: [\"scheduled\", \"confirmed\", \"arrived\", \"in_progress\", \"completed\", \"cancelled\", \"no_show\"], default: \"scheduled\"},\n      reason: {type: Text},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_appt\", columns: [\"patient_id\"]},\n      {name: \"idx_provider_appt\", columns: [\"provider_id\"]},\n      {name: \"idx_scheduled_time\", columns: [\"scheduled_datetime\"]}\n    ]\n  },\n  \n  Table Users {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      username: {type: String, unique: true, required: true, maxLength: 50},\n      email: {type: String, unique: true, required: true, maxLength: 100},\n      role: {type: String, enum: [\"physician\", \"nurse\", \"admin\", \"staff\", \"patient\"], required: true},\n      department: {type: String, maxLength: 100},\n      active: {type: Bool, default: true}\n    }\n  }\n}\n\nType PatientRegistration {\n  firstName: string,\n  lastName: string,\n  dateOfBirth: date,\n  gender: Gender?,\n  address: Address?,\n  phone: string?,\n  email: string?,\n  emergencyContact: EmergencyContact?,\n  insuranceInfo: InsuranceInfo?,\n  primaryCarePhysicianId: ProviderId?\n}\n\nType MedicalRecordUpdate {\n  recordType: MedicalRecordType,\n  dateRecorded: date,\n  data: Map<string, any>,\n  icdCode?: string,\n  snomedCtCode?: string,\n  confidentiality?: ConfidentialityLevel\n}\n\nType ClinicalNote {\n  noteType: NoteType,\n  content: string,\n  appointmentId?: AppointmentId\n}\n\nType MedicalHistoryFilters {\n  recordTypes?: MedicalRecordType[],\n  dateRange?: DateRange,\n  providerId?: ProviderId,\n  status?: MedicalRecordStatus\n}\n\nType AppointmentRequest {\n  providerId: ProviderId,\n  facilityId?: FacilityId,\n  appointmentType: string,\n  scheduledDateTime: timestamp,\n  reason: string?\n}\n\nType Address {\n  street: string,\n  city: string,\n  state: string,\n  zip: string,\n  country: string\n}\n\nType EmergencyContact {\n  name: string,\n  relationship: string,\n  phone: string\n}\n\nType InsuranceInfo {\n  provider: string,\n  policyNumber: string,\n  groupNumber: string\n}\n\nType DateRange {\n  startDate: date,\n  endDate: date\n}\n\nType PatientRecord {\n  id: PatientId,\n  mrn: string,\n  firstName: string,\n  lastName: string,\n  dateOfBirth: date,\n  gender: Gender,\n  address: Address?,\n  phone: string?,\n  email: string?,\n  emergencyContact: EmergencyContact?,\n  insuranceInfo: InsuranceInfo?,\n  primaryCarePhysician: Provider?,\n  medicalRecords: MedicalRecord[],\n  appointments: Appointment[],\n  createdAt: timestamp,\n  updatedAt: timestamp\n}\n\nType MedicalRecord {\n  id: MedicalRecordId,\n  patientId: PatientId,\n  recordType: MedicalRecordType,\n  provider: Provider,\n  dateRecorded: date,\n  data: Map<string, any>,\n  icdCode?: string,\n  snomedCtCode?: string,\n  status: MedicalRecordStatus,\n  confidentiality: ConfidentialityLevel,\n  createdAt: timestamp,\n  updatedAt: timestamp\n}\n\nType Provider {\n  id: ProviderId,\n  npi: string,\n  firstName: string,\n  lastName: string,\n  specialty: string,\n  licenseNumber: string?,\n  licenseState: string?,\n  facility: Facility?\n}\n\nType Facility {\n  id: FacilityId,\n  name: string,\n  type: FacilityType,\n  address: Address,\n  phone: string?\n}\n\nType ClinicalNoteResult {\n  noteId: ClinicalNoteId,\n  patientId: PatientId,\n  providerId: ProviderId,\n  noteType: NoteType,\n  status: ClinicalNoteStatus,\n  createdAt: timestamp\n}\n\nType MedicalHistory {\n  patientId: PatientId,\n  records: MedicalRecord[],\n  medications: MedicationRecord[],\n  allergies: AllergyRecord[],\n  immunizations: ImmunizationRecord[],\n  labResults: LabResultRecord[],\n  vitalSigns: VitalSignRecord[]\n}\n\nType ClinicalReport {\n  patientId: PatientId,\n  reportType: ClinicalReportType,\n  generatedBy: Provider,\n  generatedAt: timestamp,\n  content: ReportContent,\n  attachments: ReportAttachment[]\n}\n\nType AppointmentResult {\n  appointmentId: AppointmentId,\n  patientId: PatientId,\n  provider: Provider,\n  facility?: Facility,\n  scheduledDateTime: timestamp,\n  status: AppointmentStatus,\n  confirmationSent: boolean\n}\n\nType MedicalRecordUpdateResult {\n  recordId: MedicalRecordId,\n  patientId: PatientId,\n  updatedFields: string[],\n  status: MedicalRecordStatus,\n  updatedAt: timestamp\n}\n\nType Gender {\n  enum: [\"male\", \"female\", \"other\", \"unknown\"]\n}\n\nType MedicalRecordType {\n  enum: [\"diagnosis\", \"procedure\", \"medication\", \"lab_result\", \"vital_signs\", \"clinical_note\"]\n}\n\nType MedicalRecordStatus {\n  enum: [\"active\", \"resolved\", \"archived\"]\n}\n\nType ConfidentialityLevel {\n  enum: [\"normal\", \"restricted\", \"very_restricted\"]\n}\n\nType NoteType {\n  enum: [\"progress\", \"consultation\", \"discharge\", \"admission\", \"operative\"]\n}\n\nType ClinicalNoteStatus {\n  enum: [\"draft\", \"signed\", \"correction\"]\n}\n\nType FacilityType {\n  enum: [\"hospital\", \"clinic\", \"urgent_care\", \"nursing_home\", \"other\"]\n}\n\nType ClinicalReportType {\n  enum: [\"discharge_summary\", \"referral_letter\", \"consultation_note\", \"radiology_report\", \"lab_report\"]\n}\n\nType ReportContent {\n  sections: ReportSection[],\n  summary: string,\n  recommendations: string[]\n}\n\nType ReportSection {\n  title: string,\n  content: string\n}\n\nType ReportAttachment {\n  fileName: string,\n  mimeType: string,\n  fileSize: int,\n  downloadUrl: string\n}\n\nType AppointmentStatus {\n  enum: [\"scheduled\", \"confirmed\", \"arrived\", \"in_progress\", \"completed\", \"cancelled\", \"no_show\"]\n}\n\nType AccessPurpose {\n  enum: [\"treatment\", \"payment\", \"healthcare_operations\", \"research\", \"marketing\"]\n}\n\nType MedicationRecord {\n  medicationName: string,\n  dosage: string,\n  frequency: string,\n  prescribedDate: date,\n  prescribingProvider: Provider,\n  status: MedicationStatus\n}\n\nType AllergyRecord {\n  allergen: string,\n  reaction: string,\n  severity: AllergySeverity,\n  recordedDate: date,\n  status: AllergyStatus\n}\n\nType ImmunizationRecord {\n  vaccineName: string,\n  administrationDate: date,\n  administeredBy: Provider,\n  lotNumber: string?\n}\n\nType LabResultRecord {\n  testName: string,\n  result: string,\n  referenceRange: string,\n  status: LabResultStatus,\n  performedDate: date,\n  orderingProvider: Provider\n}\n\nType VitalSignRecord {\n  vitalSignType: string,\n  value: string,\n  measuredDate: date,\n  measuredBy: Provider\n}\n\nType MedicationStatus {\n  enum: [\"active\", \"discontinued\", \"temporary\"]\n}\n\nType AllergySeverity {\n  enum: [\"mild\", \"moderate\", \"severe\", \"life_threatening\"]\n}\n\nType AllergyStatus {\n  enum: [\"active\", \"inactive\", \"resolved\"]\n}\n\nType LabResultStatus {\n  enum: [\"final\", \"pending\", \"corrected\", \"cancelled\"]\n}\n\nValidation HealthcareConstraints {\n  hipaa_compliance: {audit_all_access: true, encrypt_phi: true, access_minimum_necessary: true},\n  patient_demographics: {required_fields: [\"first_name\", \"last_name\", \"date_of_birth\"]},\n  medical_record_retention: {value: 7, unit: \"years\"},\n  access_log_retention: {value: 7, unit: \"years\"},\n  mrn_format: {pattern: \"^[A-Z0-9]{8,15}$\", description: \"8-15 alphanumeric characters\"}\n}\n\nOperation CreatePatient {\n  type: \"transaction\",\n  inputs: [\"patientDetails\"],\n  steps: [\n    \"validate patient demographics\",\n    \"check for existing patient with same demographics\",\n    \"generate unique MRN\",\n    \"create patient record\",\n    \"log creation in audit trail\",\n    \"notify registration staff\"\n  ],\n  postconditions: [patient record created with unique MRN]\n}\n\nTransaction UpdatePatientRecord {\n  operations: [\n    {type: \"check\", condition: \"user_has_permission_to_update_record_type(param.recordUpdate.recordType, param.requestingProviderId)\", error: \"UnauthorizedAccess\"},\n    {type: \"create\", table: \"MedicalRecords\", data: {patient_id: param.patientId, record_type: param.recordUpdate.recordType, provider_id: param.requestingProviderId, date_recorded: param.recordUpdate.dateRecorded, data: param.recordUpdate.data, icd_code: param.recordUpdate.icdCode, confidentiality: param.recordUpdate.confidentiality || \"normal\"}},\n    {type: \"create\", table: \"AccessLogs\", data: {patient_id: param.patientId, user_id: \"get_current_user_id()\", provider_id: param.requestingProviderId, action: \"create\", resource_type: \"MedicalRecord\", resource_id: \"LAST_INSERT_ID()\", purpose: \"treatment\"}}\n  ],\n  onError: \"rollback\",\n  postconditions: [medical record updated, access logged]\n}\n\nBehavior HealthcarePrivacy {\n  rules: {\n    minimum_access: {users_only_access_needed_information: true},\n    audit_trail: {log_all_access_with_purpose: true},\n    data_retention: {automatically_archive_old_records: true, retain_according_to_law: true}\n  },\n  \n  notifications: {\n    unauthorized_access: \"alert security team to unauthorized access attempts\",\n    record_amendment: \"notify patient of significant changes to records\",\n    compliance_violation: \"alert compliance officer to potential violations\"\n  }\n}\n</blueprint>", "validation": {"has_thinking": true, "has_blueprint": true, "thinking_structure": ["problem_understanding", "strategic_approach", "design_preparation"], "blueprint_syntax_valid": true, "blueprint_completeness": ["service_definition", "methods_with_contracts", "database_schema", "types", "validation_rules", "operations", "transactions", "behaviors"]}}
{"id": "q_hc_222", "category": "healthcare", "difficulty": "advanced", "user_query": "Appointment scheduling system", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- Need to manage healthcare appointments with provider availability\n- Should handle different appointment types and durations\n- Must prevent double-booking and manage conflicts\n- Should support patient notifications and reminders\n\nSTRATEGIC APPROACH:\n- Create an AppointmentScheduling service with booking capabilities\n- Implement provider availability management\n- Support appointment types with different durations\n- Include conflict detection and prevention\n- Provide notification and reminder systems\n\nDESIGN PREPARATION:\n- Core operations: scheduleAppointment, cancelAppointment, checkAvailability\n- Provider schedule management with time slots\n- Appointment types with duration specifications\n- Conflict detection and resolution\n</thinking>\n\n<blueprint>\nService AppointmentScheduling {\n  description: \"Manages healthcare appointments with provider availability and patient notifications\",\n  \n  dependencies: {\n    storage: AppointmentDatabase,\n    notifications: NotificationService,\n    calendar: CalendarService,\n    auth: AccessControlService,\n    audit: AuditService\n  },\n  \n  methods: {\n    scheduleAppointment(appointmentRequest: AppointmentRequest) -> AppointmentResult {\n      preconditions: [valid patient, provider available, no conflicts],\n      postconditions: [appointment scheduled, patient notified],\n      errors: [PatientNotFound, ProviderUnavailable, ScheduleConflict]\n    },\n    \n    cancelAppointment(appointmentId: AppointmentId, cancellationReason: string, cancelledBy: UserId) -> CancellationResult {\n      preconditions: [appointment exists, valid cancellation reason],\n      postconditions: [appointment cancelled, notifications sent],\n      errors: [AppointmentNotFound, InvalidCancellation]\n    },\n    \n    rescheduleAppointment(appointmentId: AppointmentId, newTime: timestamp, rescheduledBy: UserId) -> AppointmentResult {\n      preconditions: [appointment exists, new time available],\n      postconditions: [appointment rescheduled, patient notified],\n      errors: [AppointmentNotFound, NewTimeUnavailable]\n    },\n    \n    getProviderAvailability(providerId: ProviderId, dateRange: DateRange, appointmentType: string?) -> AvailabilitySchedule {\n      preconditions: [provider exists],\n      postconditions: [returns available time slots for provider]\n    },\n    \n    checkDoubleBooking(patientId: PatientId, dateTime: timestamp, duration: int) -> DoubleBookingCheckResult {\n      preconditions: [patient exists],\n      postconditions: [returns whether patient has conflicting appointment]\n    },\n    \n    sendAppointmentReminder(appointmentId: AppointmentId) -> ReminderResult {\n      preconditions: [appointment exists, patient contact info available],\n      postconditions: [reminder sent to patient]\n    },\n    \n    bulkScheduleAppointments(requests: BulkAppointmentRequest[]) -> BulkAppointmentResult {\n      preconditions: [all requests valid, resources available],\n      postconditions: [all possible appointments scheduled],\n      errors: [PartialScheduleFailure]\n    }\n  }\n}\n\nDatabase AppointmentDatabase {\n  Table Patients {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      mrn: {type: String, unique: true, required: true, maxLength: 50},\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      date_of_birth: {type: Date, required: true},\n      phone: {type: String, maxLength: 20},\n      email: {type: String, maxLength: 100},\n      preferred_contact_method: {type: String, enum: [\"phone\", \"email\", \"sms\"], default: \"phone\"},\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_mrn\", columns: [\"mrn\"]},\n      {name: \"idx_last_name\", columns: [\"last_name\"]}\n    ]\n  },\n  \n  Table Providers {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      npi: {type: String, unique: true, required: true, maxLength: 10},\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      specialty: {type: String, maxLength: 100},\n      license_number: {type: String, maxLength: 50}\n    },\n    indexes: [\n      {name: \"idx_npi\", columns: [\"npi\"]}\n    ]\n  },\n  \n  Table AppointmentTypes {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      name: {type: String, unique: true, required: true, maxLength: 100},\n      description: {type: Text},\n      duration_minutes: {type: Int, required: true},\n      location: {type: String, maxLength: 100},\n      requires_special_equipment: {type: Bool, default: false},\n      created_at: {type: Timestamp, default: \"now()\"}\n    }\n  },\n  \n  Table ProviderSchedules {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      day_of_week: {type: String, enum: [\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"], required: true},\n      start_time: {type: Time, required: true},\n      end_time: {type: Time, required: true},\n      is_available: {type: Bool, default: true},\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_provider_schedule\", columns: [\"provider_id\", \"day_of_week\"]}\n    ]\n  },\n  \n  Table Appointments {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      appointment_type_id: {type: UUID, foreignKey: \"AppointmentTypes.id\", required: true},\n      scheduled_datetime: {type: Timestamp, required: true},\n      duration_minutes: {type: Int, required: true},\n      status: {type: String, enum: [\"scheduled\", \"confirmed\", \"arrived\", \"in_progress\", \"completed\", \"cancelled\", \"no_show\"], default: \"scheduled\"},\n      reason: {type: Text},\n      location: {type: String, maxLength: 100},\n      notes: {type: Text},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"},\n      cancelled_at: {type: Timestamp},\n      cancelled_by: {type: UUID, foreignKey: \"Users.id\"},\n      cancellation_reason: {type: String, maxLength: 200}\n    },\n    indexes: [\n      {name: \"idx_patient_appointments\", columns: [\"patient_id\"]},\n      {name: \"idx_provider_appointments\", columns: [\"provider_id\"]},\n      {name: \"idx_scheduled_time\", columns: [\"scheduled_datetime\"]},\n      {name: \"idx_status\", columns: [\"status\"]}\n    ]\n  },\n  \n  Table AppointmentReminders {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      appointment_id: {type: UUID, foreignKey: \"Appointments.id\", required: true},\n      reminder_type: {type: String, enum: [\"pre_visit\", \"post_visit\", \"follow_up\"], required: true},\n      send_time: {type: Timestamp, required: true},\n      sent_at: {type: Timestamp},\n      status: {type: String, enum: [\"pending\", \"sent\", \"failed\"], default: \"pending\"},\n      medium: {type: String, enum: [\"email\", \"sms\", \"phone\"], required: true}\n    },\n    indexes: [\n      {name: \"idx_appointment_reminder\", columns: [\"appointment_id\"]},\n      {name: \"idx_send_time\", columns: [\"send_time\"]}\n    ]\n  },\n  \n  Table BlockOutTimes {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      provider_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      start_datetime: {type: Timestamp, required: true},\n      end_datetime: {type: Timestamp, required: true},\n      reason: {type: String, maxLength: 200},\n      type: {type: String, enum: [\"vacation\", \"conference\", \"emergency\", \"maintenance\"], required: true}\n    },\n    indexes: [\n      {name: \"idx_provider_blockout\", columns: [\"provider_id\"]}\n    ]\n  },\n  \n  Table Users {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      username: {type: String, unique: true, required: true, maxLength: 50},\n      email: {type: String, unique: true, required: true, maxLength: 100},\n      role: {type: String, enum: [\"physician\", \"nurse\", \"admin\", \"scheduler\"], required: true}\n    }\n  }\n}\n\nType AppointmentRequest {\n  patientId: PatientId,\n  providerId: ProviderId,\n  appointmentTypeId: AppointmentTypeId,\n  scheduledDateTime: timestamp,\n  reason: string?,\n  location?: string\n}\n\nType DateRange {\n  startDate: date,\n  endDate: date\n}\n\nType BulkAppointmentRequest {\n  patientId: PatientId,\n  providerId: ProviderId,\n  appointmentTypeId: AppointmentTypeId,\n  requestedDateTimeRange: DateRange,\n  reason: string?\n}\n\nType AppointmentResult {\n  appointmentId: AppointmentId,\n  patient: Patient,\n  provider: Provider,\n  appointmentType: AppointmentType,\n  scheduledDateTime: timestamp,\n  durationMinutes: int,\n  status: AppointmentStatus,\n  location: string?,\n  confirmationSent: boolean\n}\n\nType CancellationResult {\n  appointmentId: AppointmentId,\n  status: CancellationStatus,\n  cancellationReason: string,\n  cancelledBy: User,\n  cancelledAt: timestamp,\n  notificationsSent: boolean\n}\n\nType AvailabilitySchedule {\n  providerId: ProviderId,\n  dateRange: DateRange,\n  availableSlots: TimeSlot[],\n  blockedTimes: BlockOutTime[],\n  appointmentType: AppointmentType?\n}\n\nType TimeSlot {\n  startTime: timestamp,\n  endTime: timestamp,\n  appointmentTypeId: AppointmentTypeId\n}\n\nType DoubleBookingCheckResult {\n  patientId: PatientId,\n  hasConflict: boolean,\n  conflictingAppointment?: Appointment,\n  dateTime: timestamp,\n  duration: int\n}\n\nType ReminderResult {\n  appointmentId: AppointmentId,\n  reminderSent: boolean,\n  medium: ContactMethod,\n  sentAt: timestamp,\n  error?: string\n}\n\nType BulkAppointmentResult {\n  scheduledAppointments: AppointmentResult[],\n  failedRequests: FailedRequest[],\n  successRate: float\n}\n\nType FailedRequest {\n  request: BulkAppointmentRequest,\n  error: string\n}\n\nType Patient {\n  id: PatientId,\n  mrn: string,\n  firstName: string,\n  lastName: string,\n  dateOfBirth: date,\n  phone: string?,\n  email: string?,\n  preferredContactMethod: ContactMethod\n}\n\nType Provider {\n  id: ProviderId,\n  npi: string,\n  firstName: string,\n  lastName: string,\n  specialty: string\n}\n\nType AppointmentType {\n  id: AppointmentTypeId,\n  name: string,\n  description: string?,\n  durationMinutes: int,\n  location: string?,\n  requiresSpecialEquipment: boolean\n}\n\nType Appointment {\n  id: AppointmentId,\n  patient: Patient,\n  provider: Provider,\n  appointmentType: AppointmentType,\n  scheduledDateTime: timestamp,\n  durationMinutes: int,\n  status: AppointmentStatus,\n  reason: string?,\n  location: string?,\n  notes: string?,\n  createdAt: timestamp,\n  updatedAt: timestamp,\n  cancelledAt?: timestamp,\n  cancelledBy?: User,\n  cancellationReason?: string\n}\n\nType BlockOutTime {\n  id: BlockOutTimeId,\n  providerId: ProviderId,\n  startTime: timestamp,\n  endTime: timestamp,\n  reason: string,\n  type: BlockOutType\n}\n\nType User {\n  id: UserId,\n  username: string,\n  email: string,\n  role: UserRole\n}\n\nType AppointmentStatus {\n  enum: [\"scheduled\", \"confirmed\", \"arrived\", \"in_progress\", \"completed\", \"cancelled\", \"no_show\"]\n}\n\nType CancellationStatus {\n  enum: [\"cancelled\", \"already_cancelled\", \"not_found\"]\n}\n\nType ContactMethod {\n  enum: [\"phone\", \"email\", \"sms\"]\n}\n\nType BlockOutType {\n  enum: [\"vacation\", \"conference\", \"emergency\", \"maintenance\"]\n}\n\nType UserRole {\n  enum: [\"physician\", \"nurse\", \"admin\", \"scheduler\"]\n}\n\nValidation AppointmentConstraints {\n  maxAppointmentDuration: {value: 240, unit: \"minutes\"},\n  minTimeBetweenAppointments: {value: 15, unit: \"minutes\"},\n  maxAdvanceBooking: {value: 365, unit: \"days\"},\n  minCancellationTime: {value: 2, unit: \"hours\"},\n  maxDailyAppointmentsPerProvider: {value: 20}\n}\n\nOperation ScheduleAppointment {\n  type: \"transaction\",\n  inputs: [\"appointmentRequest\"],\n  steps: [\n    \"validate patient and provider exist\",\n    \"check provider availability at requested time\",\n    \"check for patient double-booking\",\n    \"create appointment record\",\n    \"generate reminders if needed\",\n    \"send confirmation to patient\",\n    \"log scheduling event\"\n  ],\n  postconditions: [appointment scheduled with notifications sent]\n}\n\nTransaction CancelAppointment {\n  operations: [\n    {type: \"update\", table: \"Appointments\", where: {id: param.appointmentId}, set: {status: \"cancelled\", cancelled_at: \"now()\", cancelled_by: param.cancelledBy, cancellation_reason: param.cancellationReason}},\n    {type: \"create\", table: \"AccessLogs\", data: {patient_id: \"get_patient_id_for_appointment(param.appointmentId)\", user_id: param.cancelledBy, action: \"cancel\", resource_type: \"Appointment\", resource_id: param.appointmentId, purpose: \"treatment\"}},\n    {type: \"create\", table: \"Notifications\", data: {recipient_id: \"get_patient_id_for_appointment(param.appointmentId)\", type: \"appointment_cancelled\", message: \"Your appointment has been cancelled\"}}\n  ],\n  onError: \"rollback\",\n  postconditions: [appointment cancelled, patient notified]\n}\n\nBehavior AppointmentScheduling {\n  rules: {\n    double_booking_prevention: {check_conflicts_before_scheduling: true},\n    reminder_system: {send_reminders_24_hours_ahead: true, allow_custom_intervals: true},\n    availability_management: {respect_provider_schedules: true, block_out_vacation_times: true}\n  },\n  \n  notifications: {\n    appointment_scheduled: \"confirm appointment with patient\",\n    appointment_reminder: \"remind patient of upcoming appointment\",\n    appointment_cancelled: \"notify patient of cancellation\",\n    provider_availability_change: \"alert schedulers to availability changes\"\n  }\n}\n</blueprint>", "validation": {"has_thinking": true, "has_blueprint": true, "thinking_structure": ["problem_understanding", "strategic_approach", "design_preparation"], "blueprint_syntax_valid": true, "blueprint_completeness": ["service_definition", "methods_with_contracts", "database_schema", "types", "validation_rules", "operations", "transactions", "behaviors"]}}
{"id": "q_hc_223", "category": "healthcare", "difficulty": "advanced", "user_query": "Prescription management service", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- Need to manage prescriptions with drug information and dosing\n- Should handle prescription creation, renewal, and tracking\n- Must ensure drug interaction checks and safety protocols\n- Should support pharmacy integration and patient notifications\n\nSTRATEGIC APPROACH:\n- Create a PrescriptionManagement service with drug database\n- Implement drug interaction checking and safety protocols\n- Support prescription lifecycle (create, fill, renew, discontinue)\n- Include pharmacy integration and patient notifications\n- Ensure compliance with pharmaceutical regulations\n\nDESIGN PREPARATION:\n- Core operations: createPrescription, fillPrescription, checkInteractions\n- Drug database with interaction checking\n- Prescription lifecycle management\n- Safety protocols and alerts\n</thinking>\n\n<blueprint>\nService PrescriptionManagement {\n  description: \"Manages prescriptions with drug information, interaction checking, and pharmacy integration\",\n  \n  dependencies: {\n    storage: PrescriptionDatabase,\n    drugDatabase: DrugInteractionService,\n    pharmacy: PharmacyIntegration,\n    notifications: NotificationService,\n    auth: AccessControlService,\n    audit: AuditService\n  },\n  \n  methods: {\n    createPrescription(prescriptionRequest: PrescriptionRequest) -> PrescriptionResult {\n      preconditions: [valid patient, provider authorized, drug safety checks passed],\n      postconditions: [prescription created, safety alerts handled],\n      errors: [PatientNotFound, UnauthorizedAccess, DrugInteractionDetected]\n    },\n    \n    fillPrescription(prescriptionId: PrescriptionId, pharmacyId: PharmacyId, filledBy: PharmacistId) -> FillResult {\n      preconditions: [prescription exists, valid, not expired],\n      postconditions: [prescription marked as filled, patient notified],\n      errors: [PrescriptionNotFound, PrescriptionInvalid, PharmacyNotFound]\n    },\n    \n    renewPrescription(prescriptionId: PrescriptionId, requestingProviderId: ProviderId) -> RenewalResult {\n      preconditions: [prescription exists, eligible for renewal],\n      postconditions: [renewal request processed, safety checks performed],\n      errors: [PrescriptionNotFound, RenewalNotAllowed]\n    },\n    \n    checkDrugInteractions(drugList: DrugIdentifier[]) -> InteractionCheckResult {\n      preconditions: [valid drug identifiers],\n      postconditions: [returns interaction analysis]\n    },\n    \n    getPrescriptionHistory(patientId: PatientId) -> PrescriptionHistory {\n      preconditions: [patient exists, authorized access],\n      postconditions: [returns patient's prescription history]\n    },\n    \n    discontinuePrescription(prescriptionId: PrescriptionId, reason: DiscontinuationReason, providerId: ProviderId) -> DiscontinuationResult {\n      preconditions: [prescription exists, provider authorized],\n      postconditions: [prescription discontinued, patient notified]\n    },\n    \n    verifyPrescription(prescriptionId: PrescriptionId, verifierId: PharmacistId) -> VerificationResult {\n      preconditions: [prescription exists, pharmacist authorized],\n      postconditions: [prescription verified, ready for dispensing]\n    }\n  }\n}\n\nDatabase PrescriptionDatabase {\n  Table Patients {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      mrn: {type: String, unique: true, required: true, maxLength: 50},\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      date_of_birth: {type: Date, required: true},\n      gender: {type: String, enum: [\"male\", \"female\", \"other\", \"unknown\"]},\n      allergies: {type: JSON},  // List of known allergies\n      current_medications: {type: JSON},  // List of current medications\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_mrn\", columns: [\"mrn\"]}\n    ]\n  },\n  \n  Table Providers {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      npi: {type: String, unique: true, required: true, maxLength: 10},\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      license_number: {type: String, maxLength: 50},\n      dea_number: {type: String, maxLength: 9},  // Drug Enforcement Administration number\n      specialty: {type: String, maxLength: 100}\n    },\n    indexes: [\n      {name: \"idx_npi\", columns: [\"npi\"]}\n    ]\n  },\n  \n  Table Drugs {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      rxcui: {type: String, unique: true, required: true, maxLength: 10},  // RxNorm Concept Unique Identifier\n      name: {type: String, required: true, maxLength: 200},\n      generic_name: {type: String, maxLength: 200},\n      brand_names: {type: JSON},  // Array of brand names\n      therapeutic_class: {type: String, maxLength: 100},\n      route_of_administration: {type: String, maxLength: 50},\n      controlled_substance_schedule: {type: String, enum: [\"N\", \"I\", \"II\", \"III\", \"IV\", \"V\"]},\n      pregnancy_category: {type: String, enum: [\"A\", \"B\", \"C\", \"D\", \"X\"]},\n      breastfeeding_safety: {type: String, enum: [\"compatible\", \"caution\", \"contraindicated\"]},\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_rxcui\", columns: [\"rxcui\"]},\n      {name: \"idx_name\", columns: [\"name\"]}\n    ]\n  },\n  \n  Table Prescriptions {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      prescriber_id: {type: UUID, foreignKey: \"Providers.id\", required: true},\n      drug_id: {type: UUID, foreignKey: \"Drugs.id\", required: true},\n      dosage: {type: String, required: true, maxLength: 100},\n      quantity: {type: Int, required: true},\n      days_supply: {type: Int, required: true},\n      sig: {type: Text, required: true},  // Directions for use\n      refills_allowed: {type: Int, default: 0},\n      refills_remaining: {type: Int, default: 0},\n      status: {type: String, enum: [\"active\", \"filled\", \"on_hold\", \"discontinued\", \"expired\", \"renewed\"], default: \"active\"},\n      prescribed_date: {type: Date, required: true},\n      start_date: {type: Date, required: true},\n      end_date: {type: Date, required: true},\n      pharmacy_id: {type: UUID, foreignKey: \"Pharmacies.id\"},\n      notes: {type: Text},\n      priority: {type: String, enum: [\"routine\", \"urgent\", \"stat\"], default: \"routine\"},\n      created_at: {type: Timestamp, default: \"now()\"},\n      updated_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_prescription\", columns: [\"patient_id\"]},\n      {name: \"idx_prescriber\", columns: [\"prescriber_id\"]},\n      {name: \"idx_drug\", columns: [\"drug_id\"]},\n      {name: \"idx_status\", columns: [\"status\"]}\n    ]\n  },\n  \n  Table PrescriptionFills {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      prescription_id: {type: UUID, foreignKey: \"Prescriptions.id\", required: true},\n      pharmacy_id: {type: UUID, foreignKey: \"Pharmacies.id\", required: true},\n      filled_by: {type: UUID, foreignKey: \"Pharmacists.id\", required: true},\n      quantity_dispensed: {type: Int, required: true},\n      days_supply_dispensed: {type: Int, required: true},\n      filled_date: {type: Date, required: true},\n      verification_status: {type: String, enum: [\"pending\", \"verified\", \"requires_review\"], default: \"pending\"},\n      notes: {type: Text}\n    },\n    indexes: [\n      {name: \"idx_prescription_fill\", columns: [\"prescription_id\"]},\n      {name: \"idx_pharmacy_fill\", columns: [\"pharmacy_id\"]}\n    ]\n  },\n  \n  Table DrugInteractions {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      drug1_id: {type: UUID, foreignKey: \"Drugs.id\", required: true},\n      drug2_id: {type: UUID, foreignKey: \"Drugs.id\", required: true},\n      severity: {type: String, enum: [\"contraindicated\", \"major\", \"moderate\", \"minor\"], required: true},\n      description: {type: Text, required: true},\n      management: {type: Text}\n    },\n    indexes: [\n      {name: \"idx_drug_interaction\", columns: [\"drug1_id\", \"drug2_id\"]}\n    ]\n  },\n  \n  Table Pharmacies {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      name: {type: String, required: true, maxLength: 100},\n      address: {type: JSON},  // {street, city, state, zip}\n      phone: {type: String, maxLength: 20},\n      license_number: {type: String, maxLength: 50},\n      ncpdp_id: {type: String, maxLength: 7},  // National Council for Prescription Drug Programs ID\n      active: {type: Bool, default: true}\n    }\n  },\n  \n  Table Pharmacists {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      license_number: {type: String, unique: true, required: true, maxLength: 50},\n      first_name: {type: String, required: true, maxLength: 50},\n      last_name: {type: String, required: true, maxLength: 50},\n      pharmacy_id: {type: UUID, foreignKey: \"Pharmacies.id\", required: true}\n    },\n    indexes: [\n      {name: \"idx_license_number\", columns: [\"license_number\"]}\n    ]\n  },\n  \n  Table SafetyAlerts {\n    columns: {\n      id: {type: UUID, primaryKey: true},\n      patient_id: {type: UUID, foreignKey: \"Patients.id\", required: true},\n      prescription_id: {type: UUID, foreignKey: \"Prescriptions.id\"},\n      alert_type: {type: String, enum: [\"drug_allergy\", \"drug_interaction\", \"duplicate_therapy\", \"dosage_warning\", \"pregnancy_safety\"], required: true},\n      severity: {type: String, enum: [\"low\", \"moderate\", \"high\", \"critical\"], required: true},\n      description: {type: Text, required: true},\n      acknowledged_by: {type: UUID, foreignKey: \"Users.id\"},\n      acknowledged_at: {type: Timestamp},\n      created_at: {type: Timestamp, default: \"now()\"}\n    },\n    indexes: [\n      {name: \"idx_patient_alert\", columns: [\"patient_id\"]},\n      {name: \"idx_prescription_alert\", columns: [\"prescription_id\"]}\n    ]\n  }\n}\n\nType PrescriptionRequest {\n  patientId: PatientId,\n  prescriberId: ProviderId,\n  drugId: DrugId,\n  dosage: string,\n  quantity: int,\n  daysSupply: int,\n  sig: string,\n  refillsAllowed: int?,\n  priority?: PrescriptionPriority,\n  notes?: string\n}\n\nType DrugIdentifier {\n  rxcui: string,\n  name: string\n}\n\nType InteractionCheckResult {\n  drugs: DrugIdentifier[],\n  interactions: DrugInteraction[],\n  severitySummary: SeveritySummary,\n  recommendations: string[]\n}\n\nType SeveritySummary {\n  contraindicated: int,\n  major: int,\n  moderate: int,\n  minor: int\n}\n\nType DrugInteraction {\n  drug1: Drug,\n  drug2: Drug,\n  severity: InteractionSeverity,\n  description: string,\n  management: string?\n}\n\nType PrescriptionHistory {\n  patientId: PatientId,\n  prescriptions: Prescription[],\n  activeMedications: ActiveMedication[],\n  discontinuedMedications: DiscontinuedMedication[],\n  refillHistory: RefillRecord[]\n}\n\nType ActiveMedication {\n  drug: Drug,\n  dosage: string,\n  sig: string,\n  prescribedDate: date,\n  prescriber: Provider\n}\n\nType DiscontinuedMedication {\n  drug: Drug,\n  dosage: string,\n  prescribedDate: date,\n  discontinuedDate: date,\n  discontinuationReason: DiscontinuationReason\n}\n\nType RefillRecord {\n  prescriptionId: PrescriptionId,\n  fillDate: date,\n  quantityDispensed: int,\n  pharmacy: Pharmacy\n}\n\nType PrescriptionResult {\n  prescriptionId: PrescriptionId,\n  patient: Patient,\n  prescriber: Provider,\n  drug: Drug,\n  dosage: string,\n  quantity: int,\n  daysSupply: int,\n  refillsAllowed: int,\n  status: PrescriptionStatus,\n  prescribedDate: date,\n  startDate: date,\n  endDate: date,\n  safetyAlerts: SafetyAlert[],\n  createdAt: timestamp\n}\n\nType FillResult {\n  prescriptionId: PrescriptionId,\n  pharmacy: Pharmacy,\n  filledBy: Pharmacist,\n  quantityDispensed: int,\n  daysSupplyDispensed: int,\n  filledDate: date,\n  verificationStatus: VerificationStatus,\n  success: boolean\n}\n\nType RenewalResult {\n  originalPrescriptionId: PrescriptionId,\n  newPrescriptionId?: PrescriptionId,\n  renewalStatus: RenewalStatus,\n  reason?: string,\n  safetyAlerts: SafetyAlert[]\n}\n\nType DiscontinuationResult {\n  prescriptionId: PrescriptionId,\n  discontinuationReason: DiscontinuationReason,\n  discontinuedBy: Provider,\n  discontinuedAt: timestamp,\n  success: boolean\n}\n\nType VerificationResult {\n  prescriptionId: PrescriptionId,\n  verifiedBy: Pharmacist,\n  verifiedAt: timestamp,\n  verificationStatus: VerificationStatus,\n  notes: string?\n}\n\nType Patient {\n  id: PatientId,\n  mrn: string,\n  firstName: string,\n  lastName: string,\n  dateOfBirth: date,\n  gender: Gender?,\n  allergies: string[]\n}\n\nType Provider {\n  id: ProviderId,\n  npi: string,\n  firstName: string,\n  lastName: string,\n  licenseNumber: string,\n  deaNumber: string?\n}\n\nType Drug {\n  id: DrugId,\n  rxcui: string,\n  name: string,\n  genericName: string?,\n  brandNames: string[],\n  therapeuticClass: string?,\n  routeOfAdministration: string?,\n  controlledSubstanceSchedule: ControlledSubstanceSchedule?,\n  pregnancyCategory: PregnancyCategory?\n}\n\nType Pharmacy {\n  id: PharmacyId,\n  name: string,\n  address: Address,\n  phone: string?,\n  licenseNumber: string,\n  ncpdpId: string\n}\n\nType Pharmacist {\n  id: PharmacistId,\n  licenseNumber: string,\n  firstName: string,\n  lastName: string,\n  pharmacy: Pharmacy\n}\n\nType SafetyAlert {\n  id: SafetyAlertId,\n  alertType: SafetyAlertType,\n  severity: AlertSeverity,\n  description: string,\n  acknowledgedBy?: User,\n  acknowledgedAt?: timestamp,\n  createdAt: timestamp\n}\n\nType Address {\n  street: string,\n  city: string,\n  state: string,\n  zip: string\n}\n\nType Gender {\n  enum: [\"male\", \"female\", \"other\", \"unknown\"]\n}\n\nType PrescriptionPriority {\n  enum: [\"routine\", \"urgent\", \"stat\"]\n}\n\nType InteractionSeverity {\n  enum: [\"contraindicated\", \"major\", \"moderate\", \"minor\"]\n}\n\nType PrescriptionStatus {\n  enum: [\"active\", \"filled\", \"on_hold\", \"discontinued\", \"expired\", \"renewed\"]\n}\n\nType VerificationStatus {\n  enum: [\"pending\", \"verified\", \"requires_review\"]\n}\n\nType RenewalStatus {\n  enum: [\"approved\", \"requires_review\", \"denied\"]\n}\n\nType DiscontinuationReason {\n  enum: [\"completed\", \"adverse_reaction\", \"ineffective\", \"alternative_therapy\", \"patient_request\", \"other\"]\n}\n\nType ControlledSubstanceSchedule {\n  enum: [\"N\", \"I\", \"II\", \"III\", \"IV\", \"V\"]\n}\n\nType PregnancyCategory {\n  enum: [\"A\", \"B\", \"C\", \"D\", \"X\"]\n}\n\nType SafetyAlertType {\n  enum: [\"drug_allergy\", \"drug_interaction\", \"duplicate_therapy\", \"dosage_warning\", \"pregnancy_safety\"]\n}\n\nType AlertSeverity {\n  enum: [\"low\", \"moderate\", \"high\", \"critical\"]\n}\n\nValidation PrescriptionConstraints {\n  maxRefills: {controlled_substances: {schedule_II: 0, schedule_III_V: 5}, non_controlled: 5},\n  maxDaysSupply: {controlled_substances: 30, non_controlled: 90},\n  prescriptionLifetime: {value: 1, unit: \"year\"},\n  pediatricDosageChecks: {enabled: true, weightBasedCalculations: true},\n  deaVerification: {required_for_controlled_substances: true}\n}\n\nOperation CreatePrescription {\n  type: \"transaction\",\n  inputs: [\"prescriptionRequest\"],\n  steps: [\n    \"validate patient and provider exist and are authorized\",\n    \"check patient allergies against prescribed drug\",\n    \"check for drug interactions with current medications\",\n    \"verify dosage appropriateness for patient age/weight\",\n    \"validate controlled substance requirements\",\n    \"create prescription record\",\n    \"generate safety alerts if needed\",\n    \"log prescription creation event\"\n  ],\n  postconditions: [prescription created with safety checks completed]\n}\n\nTransaction FillPrescription {\n  operations: [\n    {type: \"check\", condition: \"prescription.status == 'active' AND prescription.refills_remaining >= 0\", error: \"PrescriptionInvalid\"},\n    {type: \"create\", table: \"PrescriptionFills\", data: {prescription_id: param.prescriptionId, pharmacy_id: param.pharmacyId, filled_by: param.filledBy, quantity_dispensed: \"get_prescription_quantity(param.prescriptionId)\", days_supply_dispensed: \"get_prescription_days_supply(param.prescriptionId)\", filled_date: \"CURRENT_DATE()\"}},\n    {type: \"update\", table: \"Prescriptions\", where: {id: param.prescriptionId}, set: {status: \"filled\", refills_remaining: \"refills_remaining - 1\"}},\n    {type: \"create\", table: \"Notifications\", data: {recipient_id: \"get_patient_id_for_prescription(param.prescriptionId)\", type: \"prescription_filled\", message: \"Your prescription has been filled at the pharmacy\"}}\n  ],\n  onError: \"rollback\",\n  postconditions: [prescription filled, status updated, patient notified]\n}\n\nBehavior PrescriptionSafety {\n  rules: {\n    interaction_checking: {mandatory_for_all_new_prescriptions: true, alert_on_major_interactions: true},\n    controlled_substance_monitoring: {check_state_database: true, limit_quantities: true},\n    allergy_crosschecking: {verify_against_patient_allergies: true, alert_on_matches: true}\n  },\n  \n  notifications: {\n    new_prescription: \"notify patient of new prescription\",\n    refill_reminder: \"remind patient when prescription is ready for refill\",\n    interaction_alert: \"alert prescriber of potential drug interactions\",\n    allergy_alert: \"warn prescriber of patient allergies\"\n  }\n}\n</blueprint>", "validation": {"has_thinking": true, "has_blueprint": true, "thinking_structure": ["problem_understanding", "strategic_approach", "design_preparation"], "blueprint_syntax_valid": true, "blueprint_completeness": ["service_definition", "methods_with_contracts", "database_schema", "types", "validation_rules", "operations", "transactions", "behaviors"]}}
