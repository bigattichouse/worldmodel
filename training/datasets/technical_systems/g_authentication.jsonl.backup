{"id": "blueprint_tech_auth_141", "category": "authentication_authorization", "difficulty": "intermediate", "user_query": "User registration and login system", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- A system to allow users to register for an account and then log in.\n- Needs to handle user credentials (username/email and password), secure storage, and session management.\n\nSTRATEGIC APPROACH:\n- Design an `AuthenticationService`.\n- It will depend on a `UserRepository` for storing user details and a `HashingService` for password security.\n- Implement methods for `register`ing new users and `login` for existing users.\n\nDESIGN PREPARATION:\n- `User` data model (id, email, passwordHash, status: Active/PendingVerification).\n- `AuthenticationService` with `registerUser`, `loginUser`, `logoutUser` methods.\n- `UserRepository` to manage user persistence.\n- `HashingService` to securely store and verify passwords.\n- `SessionManagementService` to create and invalidate user sessions.\n- Error handling for `DuplicateUser`, `InvalidCredentials`, `UserNotVerified`.\n</thinking>\n\n<blueprint>\nService AuthenticationService {\n  description: \"Manages user registration, login, and session lifecycle.\",\n  dependencies: {\n    userRepo: UserRepository,\n    hashingService: HashingService,\n    sessionService: SessionManagementService,\n    emailService: EmailNotificationService\n  },\n  methods: {\n    registerUser(email: string, password: string) -> User {\n      preconditions: [email is valid and not already registered, password meets complexity requirements],\n      postconditions: [a new user account is created with 'PendingVerification' status, verification email sent],\n      errors: [DuplicateUser, InvalidPassword, InvalidEmail]\n    },\n    loginUser(email: string, password: string) -> AuthToken {\n      preconditions: [email exists, password is correct, user is 'Active'],\n      postconditions: [a new session token is issued for the user],\n      errors: [InvalidCredentials, UserNotFound, UserNotVerified, AccountLocked]\n    },\n    verifyEmail(token: string) -> User {\n      preconditions: [token is valid and not expired],\n      postconditions: [user status is updated to 'Active'],\n      errors: [InvalidToken, TokenExpired]\n    },\n    logoutUser(token: AuthToken) -> void {\n      preconditions: [token is valid and active],\n      postconditions: [user session is invalidated],\n      errors: [InvalidToken]\n    }\n  }\n}\n\nService UserRepository {\n  methods: {\n    save(user: User) -> User;\n    findByEmail(email: string) -> User;\n    findById(userId: UUID) -> User;\n  }\n}\n\nService HashingService {\n  methods: {\n    hashPassword(password: string) -> string;\n    verifyPassword(password: string, hash: string) -> bool;\n  }\n}\n\nService SessionManagementService {\n  methods: {\n    createSession(userId: UUID) -> AuthToken;\n    invalidateSession(token: AuthToken) -> void;\n  }\n}\n\nType User {\n  id: UUID,\n  email: string,\n  passwordHash: string,\n  status: UserStatus,\n  createdAt: timestamp\n}\n\nType UserStatus {\n  enum: [ACTIVE, PENDING_VERIFICATION, INACTIVE, LOCKED]\n}\n\nType AuthToken {\n  token: string,\n  expiresAt: timestamp\n}\n</blueprint>