{"id": "blueprint_tech_infra_181", "category": "infrastructure", "difficulty": "intermediate", "user_query": "Service health monitoring system", "response": "<thinking>\nPROBLEM UNDERSTANDING:\n- A system to monitor the health of various services and applications.\n- It needs to perform periodic health checks, aggregate status, and provide a dashboard.\n\nSTRATEGIC APPROACH:\n- Design a `HealthMonitoringService`.\n- Define `MonitoredService` and `HealthCheckResult` entities.\n- Implement a method for registering services to be monitored, a scheduler for performing checks, and an API to retrieve current health statuses.\n\nDESIGN PREPARATION:\n- `MonitoredService` data model (serviceId, name, healthCheckEndpoint, checkIntervalSeconds).\n- `HealthCheckResult` data model (serviceId, timestamp, status: Healthy/Unhealthy, responseTimeMs, errorMessage).\n- `HealthMonitoringService` with methods: `registerService`, `deregisterService`, `getOverallStatus`, `getServiceStatus`.\n- `HealthCheckRepository` for persistence of services and results.\n- `SchedulerService` dependency.\n- Error handling for `ServiceNotFound`, `InvalidEndpoint`.\n</thinking>\n\n<blueprint>\nService HealthMonitoringService {\n  description: \"Monitors the health of various services and applications.\",\n  dependencies: {\n    serviceRepo: MonitoredServiceRepository,\n    resultRepo: HealthCheckResultRepository,\n    scheduler: SchedulerService,\n    httpClient: HttpClient // For making health check requests\n  },\n  methods: {\n    registerService(name: string, healthCheckEndpoint: string, checkIntervalSeconds: int) -> MonitoredService {\n      preconditions: [name is unique, healthCheckEndpoint is a valid URL, checkIntervalSeconds > 0],\n      postconditions: [a new service is registered for health monitoring and scheduled for checks],\n      errors: [DuplicateServiceName, InvalidEndpoint]\n    },\n    deregisterService(serviceId: UUID) -> void {\n      preconditions: [serviceId exists],\n      postconditions: [the service is removed from monitoring],\n      errors: [ServiceNotFound]\n    },\n    getOverallStatus() -> OverallHealthStatus {\n      preconditions: [],\n      postconditions: [returns a summary of the health of all monitored services],\n      errors: []\n    },\n    getServiceStatus(serviceId: UUID) -> ServiceHealthStatus {\n      preconditions: [serviceId exists],\n      postconditions: [returns the current health status and recent history for a specific service],\n      errors: [ServiceNotFound]\n    }\n  }\n}\n\nService MonitoredServiceRepository {\n  methods: {\n    save(service: MonitoredService) -> MonitoredService;\n    findById(serviceId: UUID) -> MonitoredService;\n  }\n}\n\nType MonitoredService {\n  id: UUID,\n  name: string,\n  healthCheckEndpoint: string,\n  checkIntervalSeconds: int,\n  status: string // e.g., 'HEALTHY', 'UNHEALTHY', 'UNKNOWN'\n}\n\nType HealthCheckResult {\n  id: UUID,\n  serviceId: UUID,\n  timestamp: timestamp,\n  isHealthy: bool,\n  responseTimeMs: int,\n  errorMessage: string | null\n}\n\nType OverallHealthStatus {\n  healthyServices: int,\n  unhealthyServices: int,\n  totalServices: int,\n  status: string // e.g., 'ALL_SYSTEMS_OPERATIONAL', 'DEGRADED_PERFORMANCE'\n}\n\nType ServiceHealthStatus {\n  service: MonitoredService,\n  recentResults: array[HealthCheckResult]\n}\n\n</blueprint>"}
